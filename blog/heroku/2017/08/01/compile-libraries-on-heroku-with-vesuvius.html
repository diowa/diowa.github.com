

<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Compile libraries on Heroku with Vesuvius</title>

  
    <meta name="description" content="How to build libraries on Heroku with Vesuvius, a Vulcan replacement">
  

  <meta name="author" content="Diowa">

  <meta content="#fff" name="theme-color">

  <link rel="canonical" href="http://www.diowa.com/blog/heroku/2017/08/01/compile-libraries-on-heroku-with-vesuvius">

  <link rel="stylesheet" type="text/css" href="/assets/application-78a3e4752264a86b7b7d484506ce0f09bd034160d413b054a56567caba5c7da4.css">
  <link href="https://netdna.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700%7COswald:300" rel="stylesheet" type="text/css" media="all">

  <!-- HTML5 shim IE8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <![endif]-->

  <meta content="diowa" property="og:site_name">
<meta content="Compile libraries on Heroku with Vesuvius" property="og:title">
<meta content="article" property="og:type">
<meta content="How to build libraries on Heroku with Vesuvius, a Vulcan replacement" property="og:description">


<meta content="http://www.diowa.com/blog/heroku/2017/08/01/compile-libraries-on-heroku-with-vesuvius" property="og:url">



<meta content="2017-08-01T00:00:00+02:00" property="article:published_time">



<meta content="geremia.taglialatela" property="article:author">



<meta content="/assets/diowa-open-graph-b0adb7f74230dfa8bec7f809819b3550b2d6027a60fba6ff0c02d5967f23976f.jpg" property="og:image">



  
  <meta content="Heroku" property="article:section">
  



  
  <meta content="Heroku" property="article:tag">
  
  <meta content="GEOS" property="article:tag">
  
  <meta content="proj.4" property="article:tag">
  
  <meta content="build libraries" property="article:tag">
  
  <meta content="build binaries" property="article:tag">
  
  <meta content="heroku-16" property="article:tag">
  
  <meta content="vesuvius" property="article:tag">
  



  <link href="https://plus.google.com/+GeremiaTaglialatela" rel="author">



  <!-- Favicons -->
  <link rel="apple-touch-icon" href="/assets/diowa-touch-icon-43b4cd7ea6b37652e51fff2e780837a5bc2532b4e77879a7f15a4d4d36d242f4.png" size="144x144">
  <link rel="icon" href="/assets/diowa-touch-icon-43b4cd7ea6b37652e51fff2e780837a5bc2532b4e77879a7f15a4d4d36d242f4.png" size="144x144">

  <!-- atom & rss feed -->
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
  <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
</head>


  <body>
    <nav class="navbar navbar-default" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar-responsive-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar icon-bar--top"></span>
        <span class="icon-bar icon-bar--middle"></span>
        <span class="icon-bar icon-bar--bottom"></span>
      </button>
      <a class="navbar-brand" href="/"><img alt="diowa" src="/assets/diowa-569bda59a493ab6b6d0edf5b3b6c55b585cfa9f56320bbaf1c2dd8ab6baea228.png" height="32" width="100"/></a>
    </div>
    <div class="navbar-collapse collapse" id="navbar-responsive-collapse">
      <ul class="nav navbar-nav navbar-right">
      
        <li class="active"><a href="/blog/" class="active">Blog</a></li>
      
      
        
        


  
    
      
        
        <li><a href="/about">About</a></li>
        
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
        
        <li><a href="/contact">Contact</a></li>
        
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  




      </ul>
    </div>
  </div>
</nav>


    


<div class="container">
  <article>
    <div class="page-header">
      <h1>Compile libraries on Heroku with Vesuvius <small></small></h1>
      <p class="text-muted">
        Posted by <b>Geremia Taglialatela</b>
        on <b>01 August 2017</b>
      </p>
    </div>
    <div class="content">
      
<p>It has been a long time since <a href="https://github.com/heroku/vulcan">Vulcan</a> has been deprecated. Now, gcc <a href="https://devcenter.heroku.com/articles/stack-packages">is no longer available at runtime on heroku-16</a> so Vesuvius comes in help.</p>

<!--more-->

<h2 id="why-vesuvius">Why Vesuvius?</h2>

<p><a href="https://github.com/heroku/vulcan">Vulcan</a> has been deprecated and GCC is only available <a href="https://devcenter.heroku.com/articles/stack-packages">at build time</a> on <code class="highlighter-rouge">heroku-16</code> stack.</p>

<p>Even with <code class="highlighter-rouge">heroku run bash</code>, compiling stuff on Heroku was painful, time consuming, and you needed a third-party cloud storage to move your compiled library in order to download it.</p>

<p>With <a href="https://github.com/tagliala/vesuvius"><strong>Vesuvius</strong></a>, this is no longer the case. During the deploy, <strong>Vesuvius</strong> will run all scripts located in <code class="highlighter-rouge">/scripts/libraries</code> and will move output files to a public directory.</p>

<p>It comes with <a href="http://proj4.org/index.html">proj.4</a> and <a href="https://trac.osgeo.org/geos/">GEOS</a> as examples.</p>

<h2 id="automatic-setup">Automatic Setup</h2>

<p><a href="https://heroku.com/deploy?template=https://github.com/tagliala/vesuvius/tree/master"><img src="https://www.herokucdn.com/deploy/button.svg" alt="Deploy" /></a></p>

<h2 id="manual-setup">Manual Setup</h2>

<ol>
  <li>Clone the repo at <a href="https://github.com/tagliala/vesuvius">https://github.com/tagliala/vesuvius</a></li>
  <li>Create a new Heroku application</li>
  <li>Set your buildpack to Heroku’s default Ruby buildpack</li>
</ol>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">heroku buildpacks:set heroku/ruby</code></pre></figure>

<ol>
  <li>Append the buildpack-ruby-rake-deploy-tasks to your buildpack list</li>
</ol>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">heroku buildpacks:add https://github.com/gunpowderlabs/buildpack-ruby-rake-deploy-tasks</code></pre></figure>

<ol>
  <li>Configure DEPLOY_TASK environment variable</li>
</ol>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">heroku config:set <span class="nv">DEPLOY_TASKS</span><span class="o">=</span>build_libraries</code></pre></figure>

<p>Deploy and navigate to your application’s root path.</p>

<h2 id="example-script">Example script</h2>

<p>All you need to do is create a bash script to compile your library.</p>

<p>This is an example for the GEOS library:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#!/bin/bash</span>

<span class="nv">LIBRARY_VERSION</span><span class="o">=</span>3.6.2

curl <span class="nt">-O</span> http://download.osgeo.org/geos/geos-<span class="k">${</span><span class="nv">LIBRARY_VERSION</span><span class="k">}</span>.tar.bz2 <span class="se">\</span>
  <span class="o">&amp;&amp;</span> <span class="nb">tar</span> <span class="nt">-xjvf</span> geos-<span class="k">${</span><span class="nv">LIBRARY_VERSION</span><span class="k">}</span>.tar.bz2 <span class="se">\</span>
  <span class="o">&amp;&amp;</span> <span class="nb">cd </span>geos-<span class="k">${</span><span class="nv">LIBRARY_VERSION</span><span class="k">}</span> <span class="se">\</span>
  <span class="o">&amp;&amp;</span> ./configure <span class="nt">--prefix</span><span class="o">=</span><span class="k">${</span><span class="nv">HEROKU_VENDOR_DIR</span><span class="k">}</span> <span class="se">\</span>
  <span class="o">&amp;&amp;</span> make <span class="o">&amp;&amp;</span> make <span class="nb">install</span> <span class="se">\</span>
  <span class="o">&amp;&amp;</span> <span class="nb">tar</span> <span class="nt">-C</span> <span class="k">${</span><span class="nv">HEROKU_VENDOR_DIR</span><span class="k">}</span> <span class="nt">-czvf</span> <span class="k">${</span><span class="nv">TARGET_DIR</span><span class="k">}</span>/geos-<span class="k">${</span><span class="nv">LIBRARY_VERSION</span><span class="k">}</span><span class="nt">-heroku</span>.tar.gz .</code></pre></figure>

<h3 id="references">References</h3>

<ul>
  <li><a href="https://github.com/tagliala/vesuvius">Vesuvius</a></li>
  <li><a href="http://www.saintsjd.com/2014/05/12/run-vendored-binaries-on-heroku.html">Run Vendored Binaries on Heroku</a></li>
  <li><a href="https://devcenter.heroku.com/articles/stack-packages">Ubuntu Packages on Heroku Stacks</a></li>
</ul>

    </div>
  </article>
  <hr>


  <ul class="list-inline">
    <li>Categories:</li>
    
    


  
    
      <li><a href="/blog/categories.html#Heroku-ref">
        Heroku
        (<span>3</span>)
      </a></li>
    
  



  </ul>


  <ul class="list-inline">
    <li>Tags:</li>
    
    


  
    
      <li><a href="/blog/tags.html#Heroku-ref">Heroku (<span>3</span>)</a></li>
    
      <li><a href="/blog/tags.html#GEOS-ref">GEOS (<span>3</span>)</a></li>
    
      <li><a href="/blog/tags.html#proj.4-ref">proj.4 (<span>3</span>)</a></li>
    
      <li><a href="/blog/tags.html#build libraries-ref">build libraries (<span>1</span>)</a></li>
    
      <li><a href="/blog/tags.html#build binaries-ref">build binaries (<span>1</span>)</a></li>
    
      <li><a href="/blog/tags.html#heroku-16-ref">heroku-16 (<span>1</span>)</a></li>
    
      <li><a href="/blog/tags.html#vesuvius-ref">vesuvius (<span>1</span>)</a></li>
    
  



  </ul>

  <ul class="pager hidden-print">
  
    <li class="previous"><a href="/blog/heroku/2016/02/26/using-rgeo-with-geos-on-heroku" title="Using RGeo with GEOS on Heroku">&larr; Previous</a></li>
  
    <!--<li><a href="/blog/archive.html">Archive</a></li>-->
  
    <li class="next"><a href="/blog/heroku/2017/08/01/using-rgeo-with-geos-on-heroku-with-apt-get" title="Using RGeo with GEOS on Heroku with apt-get">Next &rarr;</a></li>
  
  </ul>
  <ul class="nav nav-justified nav-blog hidden-print">
  
  
  


  
    
      
    
  
    
      
        
        <li><a href="/blog/archive"><span class="fa fa-archive"></span> Archive</a></li>
        
      
    
  
    
      
    
  
    
      
        
        <li><a href="/blog/categories"><span class="fa fa-folder-open"></span> Categories</a></li>
        
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
    
  
    
  
    
      
        
        <li><a href="/blog/tags"><span class="fa fa-tags"></span> Tags</a></li>
        
      
    
  




</ul>

  


  <div id="disqus_thread" class="hidden-print"></div>
<script type="text/javascript">
    
    var disqus_shortname = 'diowa'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>





</div>



    <footer>
  <div class="footer-wrapper">
    <img src="/assets/diowa-footer-285e6f3dc582358bcc50309309e5a28fd2e070a7aa883a13c700e100b891d712.png" width="56" height="64" alt="diowa" class="footer-logo">
    <div class="container">
      <ul class="list-inline pull-right">
        
          <li><a href="/blog/">Blog</a></li>
        
        
        
        


  
    
      
        
        <li><a href="/about">About</a></li>
        
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
        
        <li><a href="/contact">Contact</a></li>
        
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  




      </ul>
      <ul class="list-inline">
        <li>&copy; diowa 2018</li>
      </ul>
    </div>
  </div>
</footer>
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script async="" type="text/javascript" src="/assets/application-cdb9a8c5f535b6bcc2dbd71f7a29d680698c39f9437754b07fc4d40011943c4b.js"></script>



  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-39283101-1', 'diowa.com');
  ga('send', 'pageview');

</script>





<!-- Respond.js IE8 support of media queries -->
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

  </body>
</html>

