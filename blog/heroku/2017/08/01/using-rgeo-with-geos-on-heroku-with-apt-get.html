

<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Using RGeo with GEOS on Heroku with apt-get</title>

  
    <meta name="description" content="How to install Rgeo on Heroku, enabling support for GEOS and proj.4 coordinates">
  

  <meta name="author" content="Diowa">

  <meta content="#fff" name="theme-color">

  <link rel="canonical" href="http://www.diowa.com/blog/heroku/2017/08/01/using-rgeo-with-geos-on-heroku-with-apt-get">

  <link rel="stylesheet" type="text/css" href="/assets/application-78a3e4752264a86b7b7d484506ce0f09bd034160d413b054a56567caba5c7da4.css">
  <link href="https://netdna.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700%7COswald:300" rel="stylesheet" type="text/css" media="all">

  <!-- HTML5 shim IE8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <![endif]-->

  <meta content="diowa" property="og:site_name">
<meta content="Using RGeo with GEOS on Heroku with apt-get" property="og:title">
<meta content="article" property="og:type">
<meta content="How to install Rgeo on Heroku, enabling support for GEOS and proj.4 coordinates" property="og:description">


<meta content="http://www.diowa.com/blog/heroku/2017/08/01/using-rgeo-with-geos-on-heroku-with-apt-get" property="og:url">



<meta content="2017-08-01T00:00:00+02:00" property="article:published_time">



<meta content="geremia.taglialatela" property="article:author">



<meta content="/assets/diowa-open-graph-b0adb7f74230dfa8bec7f809819b3550b2d6027a60fba6ff0c02d5967f23976f.jpg" property="og:image">



  
  <meta content="Heroku" property="article:section">
  



  
  <meta content="RGeo" property="article:tag">
  
  <meta content="Heroku" property="article:tag">
  
  <meta content="GEOS" property="article:tag">
  
  <meta content="proj.4" property="article:tag">
  
  <meta content="apt-get" property="article:tag">
  



  <link href="https://plus.google.com/+GeremiaTaglialatela" rel="author">



  <!-- Favicons -->
  <link rel="apple-touch-icon" href="/assets/diowa-touch-icon-43b4cd7ea6b37652e51fff2e780837a5bc2532b4e77879a7f15a4d4d36d242f4.png" size="144x144">
  <link rel="icon" href="/assets/diowa-touch-icon-43b4cd7ea6b37652e51fff2e780837a5bc2532b4e77879a7f15a4d4d36d242f4.png" size="144x144">

  <!-- atom & rss feed -->
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
  <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
</head>


  <body>
    <nav class="navbar navbar-default" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar-responsive-collapse" aria-expanded="false">
        <span class="sr-only"></span>
        <span class="icon-bar icon-bar--top"></span>
        <span class="icon-bar icon-bar--middle"></span>
        <span class="icon-bar icon-bar--bottom"></span>
      </button>
      <a class="navbar-brand" href="/"><img alt="diowa" src="/assets/diowa-569bda59a493ab6b6d0edf5b3b6c55b585cfa9f56320bbaf1c2dd8ab6baea228.png" height="32" width="100"/></a>
    </div>
    <div class="navbar-collapse collapse" id="navbar-responsive-collapse">
      <ul class="nav navbar-nav navbar-right">
      
        <li class="active"><a href="/blog/" class="active">Blog</a></li>
      
      
        
        


  
    
      
        
        <li><a href="/about">About</a></li>
        
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
        
        <li><a href="/contact">Contact</a></li>
        
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  




      </ul>
    </div>
  </div>
</nav>


    


<div class="container">
  <article>
    <div class="page-header">
      <h1>Using RGeo with GEOS on Heroku with apt-get <small></small></h1>
      <p class="text-muted">
        Posted by <b>Geremia Taglialatela</b>
        on <b>01 August 2017</b>
      </p>
    </div>
    <div class="content">
      
<p>Here it is a new, super-easy approach to use Rgeo with GEOS on Heroku, by using the amazing <code class="highlighter-rouge">heroku-buildpack-apt</code> buildpack.</p>

<!--more-->

<h3 id="update-august-13th-2019">Update! August, 13th 2019</h3>

<p>Add a note about <code class="highlighter-rouge">LD_LIBRARY_PATH</code> variable and the Rake Task</p>

<h3 id="1-add-aptfile">1. Add Aptfile</h3>

<p>At the root of your repository, add a file called <code class="highlighter-rouge">Aptfile</code> with the following content:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>libproj-dev
libgeos-dev
</code></pre></div></div>

<p>Make sure it ends with a newline.</p>

<h3 id="2-add-the-heroku-buildpack-apt-buildpack">2. Add the heroku-buildpack-apt buildpack</h3>

<h4 id="method-1-using-appjson">Method 1: Using app.json</h4>

<p>You need to add the following entries:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">  </span><span class="nl">"buildpacks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/heroku/heroku-buildpack-apt"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"heroku/ruby"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span></code></pre></figure>

<h4 id="method-2-using-the-console">Method 2: Using the console</h4>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku buildpacks:add <span class="nt">--index</span> 1 https://github.com/heroku/heroku-buildpack-apt</code></pre></figure>

<h3 id="3-unset-ld_library_path">3. Unset LD_LIBRARY_PATH</h3>

<p>If you have previously set the <code class="highlighter-rouge">LD_LIBRARY_PATH</code> variable, please unset that</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku config:unset LD_LIBRARY_PATH</code></pre></figure>

<h3 id="4-deploy">4. Deploy</h3>

<p>Deploy to Heroku. Please note that if you have already installed rgeo, you need
to recompile the gem.</p>

<p>Check the deploy log:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># bad</span>
remote:        Using rgeo 0.6.0

<span class="c"># good</span>
remote:        Installing rgeo 0.6.0 with native extensions</code></pre></figure>

<p>You can force recompiling by using the <a href="https://github.com/heroku/heroku-repo">heroku repo</a> plugin, running <code class="highlighter-rouge">heroku repo:purge_cache -a appname</code> and deploying again.</p>

<h3 id="5-check">5. Check</h3>

<p>You can check that everything is working by running <code class="highlighter-rouge">heroku run console</code>:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&gt;</span> <span class="no">RGeo</span><span class="o">::</span><span class="no">Geos</span><span class="p">.</span><span class="nf">supported?</span>
<span class="o">=&gt;</span> <span class="kp">true</span></code></pre></figure>

<h3 id="6-optional-release-task">6. Optional Release task</h3>

<p>You may be interested in checking that RGeo properly supports GEOS at deploy
time. If something goes wrong, the deploy will fail.</p>

<p>Add a <code class="highlighter-rouge">release</code> entry to your <code class="highlighter-rouge">Procfile</code>:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">release: bundle <span class="nb">exec </span>rails rgeo_supports_geos</code></pre></figure>

<p>Create a rake task:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># frozen_string_literal: true</span>

<span class="n">desc</span> <span class="s1">'Check if RGeo supports GEOS'</span>
<span class="n">task</span> <span class="ss">:rgeo_supports_geos</span> <span class="k">do</span>
  <span class="nb">abort</span> <span class="s1">'Error: RGeo does not support GEOS.'</span> <span class="k">unless</span> <span class="no">RGeo</span><span class="o">::</span><span class="no">Geos</span><span class="p">.</span><span class="nf">supported?</span>
<span class="k">end</span></code></pre></figure>

<h3 id="notes">Notes</h3>

<p>An APT package may not be up to date with the latest version of the library it includes. In the before example, you will get GEOS 3.5.0, but (at the moment Iâ€™m writing) version 3.6.2 is out.</p>

<p>If you need newer versions of your libraries, you could use the following approach: <a href="/blog/heroku/2017/08/01/compile-libraries-on-heroku-with-vesuvius">Compile libraries on Heroku with Vesuvius</a>.</p>

<h3 id="references">References</h3>

<ul>
  <li><a href="https://devcenter.heroku.com/articles/buildpacks">Buildpacks</a></li>
  <li><a href="https://elements.heroku.com/buildpacks/heroku/heroku-buildpack-apt">heroku-buildpack-apt</a></li>
  <li><a href="https://devcenter.heroku.com/articles/app-json-schema#buildpacks">app.json Schema</a></li>
  <li><a href="https://devcenter.heroku.com/articles/release-phase">Release Phase</a></li>
</ul>

    </div>
  </article>
  <hr>


  <ul class="list-inline">
    <li>Categories:</li>
    
    


  
    
      <li><a href="/blog/categories.html#Heroku-ref">
        Heroku
        (<span>3</span>)
      </a></li>
    
  



  </ul>


  <ul class="list-inline">
    <li>Tags:</li>
    
    


  
    
      <li><a href="/blog/tags.html#RGeo-ref">RGeo (<span>2</span>)</a></li>
    
      <li><a href="/blog/tags.html#Heroku-ref">Heroku (<span>3</span>)</a></li>
    
      <li><a href="/blog/tags.html#GEOS-ref">GEOS (<span>3</span>)</a></li>
    
      <li><a href="/blog/tags.html#proj.4-ref">proj.4 (<span>3</span>)</a></li>
    
      <li><a href="/blog/tags.html#apt-get-ref">apt-get (<span>1</span>)</a></li>
    
  



  </ul>

  <ul class="pager hidden-print">
  
    <li class="previous"><a href="/blog/heroku/2017/08/01/compile-libraries-on-heroku-with-vesuvius" title="Compile libraries on Heroku with Vesuvius">&larr; Previous</a></li>
  
    <!--<li><a href="/blog/archive.html">Archive</a></li>-->
  
    <li class="next"><a href="/blog/open%20source/2018/09/22/blog-goes-open-source" title="Blog goes open source">Next &rarr;</a></li>
  
  </ul>
  <ul class="nav nav-justified nav-blog hidden-print">
  
  
  


  
    
      
    
  
    
      
        
        <li><a href="/blog/archive"><span class="fa fa-archive"></span> Archive</a></li>
        
      
    
  
    
      
    
  
    
      
        
        <li><a href="/blog/categories"><span class="fa fa-folder-open"></span> Categories</a></li>
        
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
    
  
    
  
    
      
        
        <li><a href="/blog/tags"><span class="fa fa-tags"></span> Tags</a></li>
        
      
    
  




</ul>

  


  <div id="disqus_thread" class="hidden-print"></div>
<script type="text/javascript">
    
    var disqus_shortname = 'diowa'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>





</div>



    <footer>
  <div class="footer-wrapper">
    <img src="/assets/diowa-footer-285e6f3dc582358bcc50309309e5a28fd2e070a7aa883a13c700e100b891d712.png" width="56" height="64" alt="diowa" class="footer-logo">
    <div class="container">
      <ul class="list-inline pull-right">
        
          <li><a href="/blog/">Blog</a></li>
        
        
        
        


  
    
      
        
        <li><a href="/about">About</a></li>
        
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
        
        <li><a href="/contact">Contact</a></li>
        
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  




      </ul>
      <ul class="list-inline">
        <li>&copy; diowa 2018</li>
      </ul>
    </div>
  </div>
</footer>
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script async="" type="text/javascript" src="/assets/application-cdb9a8c5f535b6bcc2dbd71f7a29d680698c39f9437754b07fc4d40011943c4b.js"></script>



  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-39283101-1', 'diowa.com');
  ga('send', 'pageview');

</script>





<!-- Respond.js IE8 support of media queries -->
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

  </body>
</html>

